{% extends 'base.html' %}
{% block content %}
<section class="content">
  <div class="container-fluid">

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="alert alert-info rounded shadow-sm p-2 mb-3">
          {% for msg in messages %}
            <p class="mb-0">{{ msg }}</p>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

<!--Manage User-->
    <div class="card shadow-sm rounded">
      <div class="card-body">
              <div class="card-footer d-flex justify-content-end">
        <a href="{{ url_for('admin.create_user') }}" 
           class="btn" style="background-color:#2f855a; color:white; font-weight:bold;">
          {{ t["create_new_user"] }}
        </a>
      </div>
        <table class="table table-bordered">
          <thead>
            <tr class="text-center" style="background-color:#2f855a; color:white; font-weight:bold;">
              <th>{{ t["username"] }}</th>
              <th>{{ t["role"] }}</th>
              <th>{{ t["actions"] }}</th>
            </tr>
          </thead>

          <tbody>
            {% for user in users %}
            <tr class="text-center align-middle">
              <td>{{ user.username }}</td>
              <td>{{ user.role }}</td>
              <td>

                <!-- EDIT -->
                <a href="{{ url_for('admin.edit_user', id=user.id) }}" 
                   class="btn btn-sm" 
                   style="background-color:#2f855a; color:white;" 
                   onclick="return showActionModal(this.href, 'Are you sure you want to edit this user?');">
                   {{ t['edit'] }}
                </a>
                <!-- DELETE -->
                <a href="{{ url_for('admin.delete_user', id=user.id) }}" 
                   class="btn btn-sm" 
                   style="background-color:#77967e; color:white;" 
                   onclick="return showActionModal(this.href, 'Are you sure you want to delete this user?');">
                   {{ t['delete'] }}
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Button sa ubos sa card -->
    </div>
  </div>
</section>

<!-- âœ… REUSABLE MODAL FOR LOGOUT, EDIT, DELETE -->
<div class="modal fade" id="actionModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 12px; overflow: hidden;">

      <!-- HEADER -->
      <div class="modal-header" style="background-color:#2f855a;">
        <h5 class="modal-title" id="actionModalTitle" style="color:white; font-weight:bold;">
          Confirm Action</h5>
        <button type="button" class="close text-white" data-dismiss="modal">&times;</button>
      </div>

      <!-- BODY -->
      <div class="modal-body text-center" style="padding:25px;">
        <p id="actionModalBody" style="font-size:16px; color:#155724; font-weight:500;">
          Are you sure you want to proceed?
        </p>
      </div>

      <!-- FOOTER -->
      <div class="modal-footer" style="border-top:1px solid #c3e6cb;">
        <button class="btn btn-secondary" data-dismiss="modal" style="border-radius:6px; font-weight:bold;">
          No</button>
        <a href="#" id="actionModalConfirm" class="btn" style="background-color:#2f855a; color:white; font-weight:bold; border-radius:6px;">
          Yes</a>
      </div>
    </div>
  </div>
</div>

<!-- JS TO SHOW MODAL -->
<script>
function showActionModal(actionUrl, message) {
    // Set modal message
    document.getElementById('actionModalBody').innerText = message;
    // Set the Yes button link
    document.getElementById('actionModalConfirm').href = actionUrl;
    // Show modal
    $('#actionModal').modal('show');
    return false; // Prevent default link
}
</script>

{% endblock %}

